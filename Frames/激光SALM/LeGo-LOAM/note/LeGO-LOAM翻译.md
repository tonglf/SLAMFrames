# LeGO-LOAM

LeGO-LOAM: Lightweight and Ground-Optimized Lidar Odometry and Mapping on Variable Terrain

在可变地形上的轻量级的利用地面点优化的 Iidar 里程计和建图模块

Github：https://github.com/RobustFieldAutonomyLab/LeGO-LOAM

## 摘要

我们提出了一种轻型和基于地面优化的激光雷达里程计和建图的方法LeGO-LOAM，用于地面车辆的实时六自由度姿态估计。LeGO-LOAM是轻量的，可以在低功耗嵌入式系统上实现实时姿态估计。LeGO-LOAM是基于地面优化的，它在分割和优化步骤中利用了地面。我们首先应用点云分割来滤除噪声，然后进行特征提取以获得不同的平面和边缘特征。然后，利用平面和边缘特征采用了两步Levenberg-Marquardt优化方法，来求解连续扫描中六自由度变换的不同分量。我们使用车辆在不同地形环境中收集的数据集，将LeGO-LOAM的性能与LOAM进行了比较，结果表明，LeGO-LOAM在降低计算开支的情况下达到了与LOAM类似或更好的精度。我们还将LeGO-LOAM集成到SLAM框架中，以消除漂移引起的姿态估计误差，并使用KITTI数据集进行了测试。

## 1 引言

对于智能机器人而言，地图构建和状态估计是最基本的先决要求之一。人们一直致力于利用基于视觉和基于激光雷达的方法实现实时6自由度同步定位和建图（SLAM）。尽管基于视觉的方法在回环检测方面具有优势，但如果将其用作唯一的导航传感器，相机对于照明和视点变化的敏感性可能会使此类功能不可靠。另一方面，基于激光雷达的方法即使在夜间也能发挥作用，许多3D激光雷达的高分辨率允许在大孔径上远距离捕捉环境的细节。因此，本文主要研究利用三维激光雷达来实现SLAM。

寻找两次激光雷达扫描之间位姿变换的典型方法是迭代最近邻（ICP）[1]。通过逐点查找对应关系，ICP迭代对齐两组点，直到满足停止条件为止。当扫描包含大量的点时，ICP可能会承受高昂的计算成本。为了提高ICP的效率和准确性，已经提出了许多ICP变体[2]。[3] 介绍一种点到平面ICP变体，该方法将点与局部平面面片相匹配。广义ICP[4]提出了一种匹配两次扫描的局部平面面片的方法。此外，几个ICP变种利用了并行计算来提高效率[5]–[8]。

基于特征的匹配方法越来越受到人们的关注，因为它们通过从环境中提取具有代表性的特征来减少计算资源。这些特征应适用于有效匹配和视点不变性。社区已经提出了许多检测器，例如点特征直方图（PFH）[9]和视点特征直方图（VFH）[10]，用于使用简单有效的技术从点云中提取此类特征。[11]介绍了一种使用Kanade-Tomasi角点检测器从点云中提取通用特征的方法。[12]讨论了从密集点云中提取直线和平面特征的框架。

社区还提出了许多使用特征进行点云配准的算法。[13] [14]提出了一种关键点选择算法，该算法在局部簇中执行点曲率计算。然后使用选定的关键点执行匹配和位置识别。通过将点云投影到距离图像上并分析深度值的二阶导数，[15]从具有高曲率的点中选择特征进行匹配和位置识别。假设环境由平面组成，在[16]中提出了一种基于平面的配准算法。室外环境，例如森林，可能会限制这种方法的应用。文献[17]中介绍了专门为Velodyne激光雷达设计的项圈线段（CLS）方法。CLS使用扫描的两个连续“环”中的点随机生成线。因此，将生成两个线云并用于注册。然而，这种方法受到随机生成线的挑战。文献[18]提出了一种基于分割的配准算法。SegMatch首先将分段应用于点云。然后根据特征值和形状直方图计算每个线段的特征向量。随机林用于匹配两次扫描的段。虽然这种方法可以用于在线姿态估计，但它只能提供1Hz左右的定位更新。

[19]和[20]中提出了一种低漂移实时激光雷达里程计和建图（LOAM）方法。LOAM执行点特征到边/平面的扫描匹配，以查找扫描之间的对应关系。通过计算局部点的曲率（roughness） 来提取特征。选择曲率（roughness）较高的点作为边缘特征。同样，曲率（roughness）较低的点被指定为平面特征。实时性能是通过将估计问题分为两个单独的算法来实现的。一种算法运行频率高，以较低的精度估计传感器的速度。另一种算法运行频率较低，但可以以高精度获得运动估计。将这两个估计值融合在一起，以产生高频和高精度的单个运动估计值。在KITTI里程计基准点上，通过仅使用激光雷达的估算方法，LOAM的结果精度达到最佳[21]。

在这项工作中，我们致力于为安装了3D激光雷达的地面车辆提供可靠、实时的六自由度姿态估计，其方式在小型嵌入式系统上可以实现高效运转。出于几个原因，这样一项任务并非微不足道。由于尺寸有限，许多无人地面车辆（UGV）没有悬架或强大的计算单元。小型无人地面车辆（UGV）在多变的地形上行驶时，经常会遇到非平稳运动，因此，采集的数据往往会带有运动畸变。由于在较大的运动下只有有限的重叠区域，在两次连续扫描之间也很难找到可靠的特征对应。此外，从3D激光雷达接收到的大量点对使用有限的车载计算资源进行实时处理提出了挑战。

当我们为这些任务实施LOAM时，当UGV以平滑运动和稳定特性运行，并且有足够的计算资源支持时，我们可以获得低漂移运动估计。然而，当资源受限时，LOAM的性能会恶化。由于需要计算密集三维点云中每个点的曲率（roughness），轻量级嵌入式系统上特征提取的更新频率不能始终跟上传感器的更新频率。UGV在噪声环境中的运行也对loam提出了挑战。由于在小型无人地面车辆（UGV）上，激光雷达的安装位置通常接近地面，因此来自地面的传感器噪声可能持续存在。例如，从草地返回的激光可能会存在较高的roughness values。因此，可能会从这些点提取不可靠的边缘特征。类似地，激光也会从树叶返回的点中提取边缘或平面特征。这种特征对于扫描匹配通常不可靠，因为在两次连续扫描中可能看不到相同的草叶或树叶。使用这些特征可能会导致不准确的对齐和较大的drift。

因此，我们提出了一种轻量化，面向地面优化的LOAM（LeGO-LOAM），用于复杂地形环境中UGV的姿态估计。LeGO-LOAM是轻量级的，可以在嵌入式系统上实现实时姿态估计和建图。执行点云分割以在分离地面之后，丢弃那些可能代表不可靠特征的点。 LeGO-LOAM也是基于地面优化的，我们提出了两步优化姿势估计的方法。在第一步中，使用从地面提取的平面特征来获得 $[t_z，θ_{roll}，θ_{pitch}]$（利用前后帧匹配的地面点）。在第二步中，变换的其余部分 $[t_x，t_y，θ_{yaw}]$ 通过匹配 分割点云提取的边缘特征 来获得。我们还集成了回环检测的能力，以纠正运动估计漂移。论文的其余部分组织如下。第二节介绍了用于实验的硬件。第三节详细介绍了提出的方法。第四节介绍了在各种室外环境下进行的一系列实验。

## 2 系统硬件

利用Velodyne VLP-16 和 HDL-64E 三维激光雷达采集的数据集对本文提出的框架进行了验证。VLP-16 测量范围高达100m，精度为 ±3cm。它的垂直视野（FOV）为 $30^{\circ}$（$±15^{\circ}$)（上下15度），水平视野为 $360^{\circ}$。16线传感器提供 $2^{\circ}$ 的垂直角度分辨率。根据旋转速率，水平角度分辨率从 $0.1^{\circ}$ ~ $0.4^{\circ}$ 不等。在本文中，我们选择了10Hz 的扫描速率，它提供了$0.2^{\circ}$ 的水平角度分辨率。HDL-64E（在本研究中通过KITTI数据集进行了探索）的水平FOV也为 $360^{\circ}$ ，但还有 48 个通道。HDL-64E 的垂直视野为 $26.9^{\circ}$。

本文使用的 UGV 是 Clearpath Jackal。由270瓦时锂电池供电，最大速度为 2.0m/s，最大有效载荷为20kg。Jackal 还配备了一个低成本的惯性测量单元（IMU），即 CH Robotics UM6方位传感器。

该框架在两台计算机上进行了验证：一台 Nvidia Jetson TX2 和一台配备2.5 GHz i74710MQ  CPU 的笔记本电脑。Jetson TX2 是一款嵌入式计算设备，配备 ARM Cortex-A57 CPU。选择笔记本电脑 CPU 以匹配[19]和[20]中使用的计算硬件。本文中的实验仅使用这些系统的CPU。

## 3 轻型激光雷达里程计和地图

### A 系统总览

论文框架的概述如图1所示。该系统接收来自3D激光雷达的输入，并输出6个自由度的姿态估计。整个系统分为五个模块。第一个模块是分割（分类），将单个扫描的点云投影到范围图像上进行分割（分类）。然后将分割后的点云发送到特征提取模块。然后，激光雷达里程计从上述模块中提取特征，找到与连续扫描相关的变换。这些特征将在LIDAR建图模块中做进一步的处理，该模块会将它们对齐到全局点云地图。最后，变换积分模块将激光雷达里程计和激光雷达建图的姿态估计结果进行融合，输出最终的姿态估计。与[19]和[20]的原始广义的LOAM框架相比，所提出的方法寻求提高地面车辆的效率和精度。下面介绍这些模块的详细信息。

### B 分割

设 $P_t = \{ p_1 ， p_2 ， … ， p_n \}$ 为在时间 t 获得的点云，其中 $p_{i}$ 是 $P_{t}$ 中的一个点。$P_{t}$ 首先投影到范围图像上。投影距离图像的分辨率为 1800（个点）×16线，因为 VLP-16 的水平和垂直角度分辨率分别为 $0.2^{\circ}$ 和 $2^{\circ}$ 。 $P_{t}$ 中的每个有效点 $p_{i}$ 占据图像中的一个pixel。与$p_{i}$ 关联的范围值 $r_{i}$ 表示从对应点 $p_{i}$ 到传感器的欧氏距离。由于斜坡地形在许多环境中都很常见，因此我们不认为地面是水平面。在分割之前，对距离图像进行列式评估（可视为地平面估计[22]），以提取地面点。在此过程之后，可能代表地面的点被标记为地面点，不用于后续分割（分类）。

然后，对距离图像应用基于图像的分割方法[23]，将点分组为多个簇。来自同一簇的点被指定一个唯一的标签。请注意，地面点是一种特殊类型的群集。对点云进行聚类可以提高处理效率和特征提取的精度。假设机器人在含有噪声的环境中工作，小物体（例如树叶）可能会形成琐碎和不可靠的特征，因为在两次连续扫描中不太可能看到相同的树叶。为了使用分割的点云进行快速可靠的特征提取，我们忽略少于30个点的聚类。分割前后的点云可视化如图2所示。原始点云包含许多点，这些点是从周围可能产生不可靠特征的植被中获取的。

在此过程之后，仅保留可能代表大型对象（例如树干）的点（图2（b））和地面点，以供进一步处理。同时，范围图像中仅保存这些点。我们还获得了每个点的三个属性：（1）其作为地面点或分割点的标签，（2）其在范围图像中的列和行索引，以及（3）其范围值。这些属性将在以下模块中使用。

### C 特征提取

特征提取过程类似于[20]中使用的方法。然而，==**我们不是从原始点云中提取特征，而是从地面点和分割后的点中提取特征。**==设 S 为距离图像同一行的 $p_{i}$ 的连续点集。S 中的一半点位于 $p_{i}$ 的两侧。在本文中，我们将|S| 设置为10。使用分割期间计算的范围值，我们可以评估在 S 中的点 $p_{i}$ 的曲率（roughness）值，

为了从各个方向均匀地提取特征，我们将距离图像水平分割为几个相等的子图像。然后，我们根据roughness值 c 对子图像每行中的点进行排序。与loam类似，我们使用阈值 $c_{th}$ 来区分不同类型的特征。我们将 c 大于 $c_{th}$ 的点称为边特征点，将 c 小 于$c_{th}$ 平的点称为面特征点。然后，从子图像的每一行中选择最大值为 c 的 $n_{\mathbb{F}{e}}$ 边缘特征点。$n_{\mathbb{F}{p}}$ 中具有最小值 c 的平面特征点（可标记为地面点或分段点）的选择方式相同。设 ${\mathbb{F}{e}}$ 和 ${\mathbb{F}{p}}$ 是所有子图像的所有边缘和平面特征的集合。这些特征如图2（d）所示。然后，我们从子图像中的每一行提取最大值为 c 的 ${{F}{e}}$ 边缘特征，这些特征不属于地面。类似地，我们从子图像中的每一行提取最小值为 c 的 ${F}{p}$ 平面特征，这些特征一定属于地面点。定义 ${{F}{e}}$和 ${{F}{p}}$ 是此过程中所有边和平面特征的集合。在这里，我们有 $F_{e}\subset\mathbb{F}_{e}$  和 $F_{p}\subset\mathbb{F}_{p}$， 图2（c）显示了 $F_{e}$  和 $F_{p}$ 中的特征。在本文中，我们将 $360^{\circ}$ 范围图像分为 6 个子图像。每个子图像的分辨率为 300×16 线（1800/6 = 300）。$n_{F_{e}}$、$n_{F_{p}}$ （明显的角点和面点）、$n_{\mathbb{F}_{e}}$、 和 $n_{\mathbb{F}_{p}}$ 分别被选取为2、4、40 和 80。

### D 雷达里程计

激光雷达里程计模块估计两次连续扫描之间的传感器运动。通过执行点到边和点到平面扫描匹配，可以找到两次扫描之间的转换。换句话说，我们需要从上一次扫描的特征集 $\mathbb{F}_{e}^{t-1}$ 和 $ \mathbb{F}_{p}^{t-1}$ 中找到 $F_{e}^{t}$  和 $F_{p}^{t}$ 中的点的相应特征。为简洁起见，可在[20]中找到查找这些对应关系的详细程序。

但是，我们注意到，可以进行一些更改以提高特征匹配的准确性和效率：

1. 基于标签的匹配：由于 $F_{e}^{t}$ 和 $F_{p}^{t}$ 中的每个特征在聚类后都使用标签进行编码，因此我们只能从 $\mathbb{F}_{e}^{t-1}$  和 $\mathbb{F}_{p}^{t-1}$ 中找到具有相同标签的对应关系。对于$F_{p}^{t}$ 中的平面要素，仅使用在 $\mathbb{F}_{p}^{t-1}$ 中标记为地面点的点用于查找planar patch作为对应。对于 $F_{e}^{t}$ 中的边特征，其对应的边线位于分段簇的 $\mathbb{F}_{e}^{t-1}$ 中。用这种方法寻找对应关系有助于提高匹配精度。换句话说，同一对象的匹配对应更可能在两次扫描之间找到。这一过程也缩小了潜在匹配对象的范围。

2. 两步L-M优化：在[20]中，将当前扫描的边缘和平面特征点之间的距离及其与前一次扫描的对应关系的一系列非线性表达式编译成一个综合距离向量。采用Levenberg-Marquardt（L-M）方法来寻找最小距离两次连续扫描之间的转换。

本文介绍了一种两步L-M优化方法。最佳的变换矩阵 T 由两步计算获得：（1）通过匹配$F_{p}^{t}$ 中的平面特征和它们在$\mathbb{F}_{p}^{t-1}$ 中的对应关系来估计 $\left[t_{z}, \theta_{\text {roll }}, \theta_{\text {pitch }}\right]$，（2）剩余的 $\left[t_{x}, t_{y}, \theta_{\text {yaw }}\right]$ 使用 $F_{e}^{t}$ 中的边特征和它们在 $\mathbb{F}_{e}^{t-1}$ 中的对应关系来估计，同时使用 $\left[t_{z}, \theta_{\text {roll }}, \theta_{\text {pitch }}\right]$ 作为约束。应该注意的是，虽然也可以从第一个优化步骤中获得 $\left[t_{x}, t_{y}, \theta_{y a w}\right]$，但它们的精度较低，并且不用于第二个步骤。最后，通过融合 $\left[t_{z}, \theta_{\text {roll }}, \theta_{\text {pitch }}\right]$ 和 $\left[t_{x}, t_{y}, \theta_{y a w}\right]$ 找到两个连续扫描之间的6D转换。通过使用提出的两步优化方法，我们观察到，在计算时间减少约 35% 的情况下，可以达到类似的精度（表III）。

### E 雷达建图

激光雷达建图模块将  $\left\{\mathbb{F}_{e}^{t}, \mathbb{F}_{p}^{t}\right\}$ 中的特征与周围的点云映射 $\bar{Q}^{t-1}$ 进行匹配，以进一步优化姿势变换，但运行频率较低。然后，这里再次使用 L-M 方法来获得最终转换。我们请读者参考[20]中的描述，了解详细的匹配和优化过程。

LeGO-LOAM 的主要区别在于最终点云地图的存储方式。我们不保存单个点云地图，而是保存每个单独的特征集 $\left\{\mathbb{F}_{e}^{t}, \mathbb{F}_{p}^{t}\right\}$。定义$M^{t-1}=\left\{\left\{\mathbb{F}_{e}^{1}, \mathbb{F}_{p}^{1}\right\}, \ldots,\left\{\mathbb{F}_{e}^{t-1}, \mathbb{F}_{p}^{t-1}\right\}\right\}$ 为保存所有先前特征的集合。 $M^{t-1}$ 中的每个特征集也与扫描时传感器的姿势对应。然后 $\bar{Q}^{t-1}$ 可以通过两种方式从 $M^{t-1}$ 获得。

在第一种方法中，$\bar{Q}^{t-1}$ 是通过选择传感器视野中的特征集获得的。为简单起见，我们可以选择传感器位姿在传感器当前位置 100 m 范围内的特征集（离当前帧小于100m的关键帧）。然后，将所选的特征集转换并融合为单个局部地图 $\bar{Q}^{t-1}$（将关键帧拼起来获得一个局部地图）。这种地图选择技术类似于[20]中使用的方法。

我们还可以将姿势图SLAM集成到LeGO-LOAM中。每个特征集的传感器姿势可以建模为姿势图中的一个节点。特征集合集 $\left\{\mathbb{F}_{e}^{t}, \mathbb{F}_{p}^{t}\right\}$可被视为此节点的传感器测量值。由于激光雷达测绘模块的姿态估计漂移非常小，我们可以假设在短时间内没有漂移。在这种方式中， $\bar{Q}^{t-1} $ 可通过选择最近的一组特征集形成，即  $\bar{Q}^{t-1}= \left\{\left\{\mathbb{F}_{e}^{t-k}, \mathbb{F}_{p}^{t-k}\right\}, \ldots,\left\{\mathbb{F}_{e}^{t-1}, \mathbb{F}_{p}^{t-1}\right\}\right\}$, 其中 k 定义 $\bar{Q}^{t-1} $ 的大小。然后，可以使用L-M优化后获得的转换添加 $\bar{Q}^{t-1} $ 中新节点和所选节点之间的空间约束。我们可以通过执行回环检测来进一步消除该模块的漂移。在这种情况下，如果使用ICP在当前特征集和之前的要素集之间找到了匹配项，则会添加新约束。然后，通过将姿势图发送到优化系统（如[24]），更新传感器的估计姿势。请注意，只有第四章（D）中的实验使用此技术创建其周围的地图。

## 4 实验



## 5 结论

我们提出了一种轻量化、基于地面优化的激光雷达里程计和地图绘制方法LeGO-LOAM，用于在复杂环境中对UGV进行实时姿态估计。LeGO-LOAM是轻量级的，它可以在嵌入式系统上使用，并实现实时性能。LeGO-LOAM也可以基于地面优化，实现地面分离、点云分割和改进的L-M优化。在此过程中，可能表示不可靠特征的无价值点将被过滤掉。两步L-M优化分别计算姿势变换的不同分量。在室外环境中收集的一系列UGV数据集上对所提出的方法进行了评估。结果表明，与最先进的LOAM算法相比，LeGO-LOAM可以达到类似或更好的精度。LeGO-LOAM的计算时间也大大减少。未来的工作包括探索其在其他类别车辆上的应用。

尽管 LeGO-LOAM特别适合于地面车辆的姿态估计，但其应用也可以扩展到其他 vehicles，如无人机（UAV），只需稍作改动。当将LeGO-LOAM应用于无人机时，我们不会假设扫描中存在地面。扫描的点云将在不提取地面的情况下进行分割。特征提取过程与选择 $F_{e}$, $\mathbb{F}_{e}$  和 $\mathbb{F}_{p}$ 的过程相同。不再从标记为地面点的点提取 $F_{p}$ 的平面特征，而是从所有分割点中选择  $F_{p}$ 中的特征。然后，将使用原始L-M方法来获得两次扫描之间的转换，而不是使用两步优化方法。虽然在这些变化后计算时间会增加，但LeGO-LOAM仍然是有效的，因为分割后在嘈杂的室外环境中忽略了大量的点。估计的特征对应的准确性可能会提高，因为它们受益于分割。此外，LeGO-LOAM online执行回环检测的功能使其成为长时间导航任务的有用工具。

## 相较于LOAM的改进:

前端:

- 1.对地面点进行分类和提取，避免一些边缘点的提取
- 2.用用了一个简单的点云聚类算法，剔除了一些可能的outlier

后端:

- 1.使用SLAM关键帧的概念对后端部分进行了重构
- 2.引入回环检测和位姿图优化概念，使得地图的全局一致性更好



------------------------------------------------
版权声明：本文为CSDN博主「每天都在努力学习SLAM的小黑」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/weixin_45626706/article/details/122027456