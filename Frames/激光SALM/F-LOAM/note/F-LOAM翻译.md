# F-LOAM : Fast LiDAR Odometry and Mapping

作者：Han Wang, Chen Wang, Chun-Lin Chen, and Lihua Xie

github：https://github.com/wh200720041/floam

翻译参考：https://cloud.tencent.com/developer/article/1941707

## 摘要

同时定位与建图（SLAM）在机器人领域有着广泛的应用，如自动驾驶和无人机等领域。一个好的SLAM系统其计算效率和定位精度是至关重要。现有的基于激光雷达的SLAM研究通常将问题描述为两个模块：scan-to-scan 匹配和 scan-to-map 匹配。这两个模块都是通过迭代计算来解决的，计算量很大。在本文提出了一个通用的解决方案，旨在为基于激光雷达的SLAM提供一个计算效率高、精度高的框架。具体来说，我们采用了一种非迭代的两级失真补偿方法来降低计算量。对于每个扫描输入，提取边缘和平面特征，分别匹配到局部边缘图和局部平面图，并考虑局部平滑度进行迭代姿态优化。通过深入的实验评估了其在具有挑战性的场景中的性能，包括仓库自动导引车（AGV）的定位和自动驾驶的公共数据集。该方法在公共数据集评估中以10hz以上的处理率获得了很好的定位精度，为实际应用提供了性能和计算成本之间的良好折衷。该方法目前是KITTI数据集排名中最准确、最快的开源SLAM系统之一。

![img](https://ask.qcloudimg.com/http-save/yehe-5926470/8aac262394cc2cb44eb28e91d1e9e200.gif)



![img](https://ask.qcloudimg.com/http-save/yehe-5926470/48417f303448d5dec0f2b0e15867a254.png?imageView2/2/w/1620)

**图1:在KITTI数据集上提出的方法的示例(a） 显示序列05上的建图的结果。（b）是通过整合摄像机视图重建的三维道路景观(c） 绘制从F-LOAM到地面的轨迹。**

## 1 引言

同时定位与映射（SLAM）是机器人学中最基本的研究课题之一。基于车载传感器，在未知或部分未知的环境中定位机器人并构建周围地图是一项任务。根据感知设备的不同，它大致可以分为激光雷达和视觉SLAM。与视觉SLAM相比，激光雷达SLAM通常在姿态估计方面更精确，并且对环境变化（如照明和天气变化）具有鲁棒性[1]。因此，LiDAR SLAM被许多机器人应用广泛采用，如自动驾驶[2]、无人机检查[3]和仓库操作[4]。

虽然现有的激光雷达SLAM在公共数据集评估方面取得了良好的效果，但在实际应用中仍存在一些局限性。限制之一是在不同环境下的鲁棒性，例如，从室内到室外环境以及从静态到动态环境。例如，[5]在室内场景中表现出良好的性能，但在室外环境中定位精度下降很多。另一个挑战是计算成本。在许多机器人平台（如无人机）中，计算资源有限，车载处理单元应同时执行高频定位和路径规划[6]。此外，许多作品都不是开源的，因此很难检索到相同的结果。

估计两个点云帧之间变换的最经典方法是迭代最近点（ICP），其中两个点云帧通过最小化点云距离迭代对齐。然而，优化过程中涉及大量的点，计算效率低下。另一种方法是匹配计算效率更高的特征。一个典型的例子是激光雷达里程计和建图（LOAM），它主要思路是提取边缘和平面特征，并通过最小化点到平面和点到边缘的距离来计算姿态。==**然而，畸变补偿和激光里程计都需要迭代计算，这仍然是昂贵的计算。**==

本文介绍了一种轻量型激光雷达SLAM，旨在为公众提供一种实用的实时激光雷达SLAM解决方案。提出了一种结合特征提取、失真补偿、姿态优化和建图的新框架。与传统方法相比，**本文采用了非迭代的两级失真补偿方法来代替计算效率低下的迭代失真补偿方法**。在连续扫描点云帧中，具有较高局部平滑度的边缘特征和具有较低平滑度的平面特征通常是一致的。这些点对于匹配更为重要。为了提高定位精度，在迭代姿态估计中还考虑了**局部几何特征**。它能够在低功耗的嵌入式计算单元上实现高达20hz的实时性能。为了证明该方法的鲁棒性，对该方法进行了全面的评价，包括室内和室外实验。与现有的最新方法相比，该方法能够以较低的计算代价获得具有竞争力的定位精度，这是性能和速度之间的一个很好的折衷。值得注意的是，所提出的方法是KITTI基准中最准确和最快的开源方法之一。

本文组织如下：第二节回顾了现有激光雷达SLAM方法的相关工作。第三节描述了拟议方法的细节，包括特征点选择、激光点对齐、激光里程计估计和映射。第四节给出了实验结果，第五节给出了结论。

## 2 相关工作

激光雷达SLAM中最关键的步骤是点云的匹配。现有的工作主要利用点云之间的对应关系，包括两大类：原始点云匹配和特征点对匹配。对于原始点云匹配，迭代最近点(ICP)[7]方法是最经典的方法。ICP通过在欧几里德空间中找到最近的点来测量对应点。通过迭代最小化对应点之间的距离残差，两个点云之间的姿势变换收敛到最终位置。改进的点云匹配是IMLS-SLAM[9]，其中为每个点指定了一个权重值。基于目标点的局部曲面法线，采用隐式最小二乘法（IMLS）计算每个权重。然而，应用原始点云匹配的计算成本通常很高，例如，在IMLSSLAM中估计一帧需要1.2秒，这远远不是实时性能要求。

基于特征的方法主要利用点到面/边缘匹配，并且得到了广泛的应用。由LOAM[10]引入，这已成为以下工作的标准。基于局部平滑度分析，预先提取边缘和曲面，并将当前点云中的点与地图中的边缘和曲面进行匹配。距离代价表示为点、边和曲面之间的欧氏距离。还有许多工作扩展了LOAM以实现更好的性能，例如，LeGO-LOAM在特征提取之前分离地面优化。对于自动引导车辆（AGV）[11]，z轴并不重要，在大多数情况下，我们可以假设机器人在2D空间中移动。因此，地面点对x-y平面的定位没有贡献。这种方法也广泛应用于地面车辆。

一些工作试图通过引入额外的模块来提高性能。环路闭合检测是SLAM中的另一个关键组件。激光雷达里程计通常会出现不可避免的漂移，这在长期的大满贯中可能非常重要。因此，在一些大规模场景中，循环闭包在后端用于识别重复的位置。例如，在仅使用激光雷达的里程计和定位（LOL）中，作者将激光雷达里程计扩展到具有环路闭合的全满贯中[12]。通过闭合回路，可以校正里程计漂移误差。与惯性测量单元（IMU）的融合是一种替代解决方案。Shan等人提出了一种IMU和GPS的融合方法，名为LIO-SLAM[13]。不同的传感器输入是同步和紧密耦合的。经证明，在室外环境中，融合式SLAM系统比 LOAM 更精确。基于融合的方法在定位精度上有了提高。然而，多传感器融合需要同步和全面校准。

在过去几年中，也有一些与深度学习相关的工作尝试使用卷积神经网络（CNN）进行点云处理。特征不是手工制作的，而是通过CNN训练提取的。例如，在CAE-LO[14]中，作者通过无监督卷积自动编码器（CAE）提出了基于深度学习的特征点选择规则[15]，而激光雷达里程估计仍然基于特征点匹配。实验结果表明，所学习的特征可以提高匹配成功率。虽然深度学习方法在公共数据集中表现出良好的性能，但在不同的环境中，如室内/室外和城市/农村场景中，深度学习方法并不健壮。例如，[16]在语义KITTI数据集中有很好的性能。然而，当移动到室内环境或某些复杂环境中时，相同的算法会失败。

## 3 研究方法

在本节中，将详细描述所提出的方法。首先提出了传感器模型和特征提取。然后对提取的特征进行畸变补偿校正。然后，我们提出了通用特征提取和全局特征估计。最后介绍了激光里程计的计算方法和建图方法。

**A 传感器模型与特征提取**

机械式三维激光雷达通过旋转一个尺寸为M的垂直排列的激光束阵列来感知周围的环境。它用M个平行读数扫描垂直面。在每个扫描间隔期间，激光阵列在水平面上以恒定速度旋转，同时激光测量按顺时针或逆时针顺序进行。对于机械激光雷达传感器模型，我们将第k次激光雷达扫描表示为$P_k$，每个点表示为$P_k^{(m,n)}$，其中$m \epsilon [1,M]$ 和 $n\epsilon[1, N]$。

原始点云匹配方法（如ICP）对噪声和动态对象（如人类）非常敏感。此外，激光雷达扫描包含数以万计的点，这使得ICP计算效率低下。与ICP等原始点云匹配方法相比，特征点匹配在实际应用中更具鲁棒性和效率。为了提高匹配精度和匹配效率，这里利用点云数据的表面特征和边缘特征，同时剔除了噪声或不太显著的点。如上所述，三维机械激光雷达返回的点云在垂直方向上是稀疏的，在水平方向上是稠密的。因此，水平方向的特征更加明显，在水平方向上进行错误特征检测的可能性较小。对于每一个点云，我们聚焦在水平面上，并通过计算局部曲面的平滑度。基于点ID n可以很容易地收集 S（m；n）k，这与局部搜索相比可以减少计算量。在实验中，我们分别沿顺时针和逆时针方向选取了5个点。对于平面（如墙），平滑度值较小，而对于角点或边点，平滑度值较大。对于每个扫描平面Pk，使用高曲率选择边缘特征点，使用低曲率选择曲面特征点。因此，我们可以将边缘特征集表示为Ek，曲面特征集表示为Sk。（这里计算曲率的方法与 LOAM 中的一致）

**B 运动估计与失真补偿**

在LOAM和LeGO-LOAM等现有方案中，通过点云帧对点云帧匹配来校正失真，该匹配方法迭代地估计两个连续激光扫描点之间的转换。然而，要找到变换矩阵需要迭代计算，计算效率很低。在本篇论文中提出使用两级失真补偿来降低计算成本。请注意，大多数现有的三维激光雷达能够以10赫兹以上的频率运行，两次连续激光雷达扫描之间的时间通常非常短。因此，我们可以先假设短时间内的角速度和线速度恒定，来预测运动并校正畸变。在第二阶段，在姿态估计过程之后，将重新计算畸变，并且将重新计算的未畸变特征更新到最终的地图。在实验中，我们发现两级畸变补偿可以达到相似的定位精度，但计算成本要低得多。表示机器人在第k次扫描时的姿态为4x4齐次变换矩阵$T_k$，则连续两帧k-1和k之间的6自由度变换可由:
$$
\xi^k_{k-1} = log(T_{k-2}^{-1}T_{k-1})
$$
这里，$\xi$ 是李代数。连续扫描之间的小周期 t 的变换可通过线性插值进行估计：
$$
T_k(\delta t)=T_{k-1}exp(\frac{N-n}{N}\xi^k_{k-1})
$$
这里 $exp(\xi)$ 是李代数向李群的转换。当前扫描 $P_k$ 的失真可通过以下方式进行校正：
$$
\tilde{P_k} = \{T_k(\delta t) P_k^{(m,n)}|P_k^{(m,n)} \epsilon P_k \}
$$
未变形的特征将在下一节中用于找到机器人的姿态。

**C 姿态估计**

位姿估计通过去畸变的边缘特征和平面特征与全局地图对齐。全局特征点地图包括边缘特征地图和平面特征地图，分别进行更新和维护。为了减少搜索的计算量，边缘特征地图和平面特征地图都存储在三维KD树中。通过从边缘和平面特征图中收集附近的点来估计全局线和平面。对于每个边缘特征点， 从全局边缘特征图中计算其附近点的协方差矩阵。当点分布在一条直线上时，协方差矩阵包含一个更大的特征值。将与最大特征值相关的特征向量视为直线方向，直线的位置视为附近点的几何中心。类似地，对于每个平面特征点，这里可以得到一个具有位置和曲面范数的全局平面。注意，与全局边不同，全局平面的范数作为与最小特征值相关的特征向量。

导出相应的最优边/平面后，我们可以从 $P_k$ 中找到每个特征点的链接全局边或平面。这种对应可以通过最小化特征点和全局边/平面之间的距离来估计当前帧和全局地图之间的最佳姿势。(点到线的距离，点到面的距离，与LOAM 一致)

传统的特征匹配只优化了上述几何距离，而没有考虑每个特征点的局部几何分布。然而，可以观察到，在连续扫描中，**具有较高局部平滑度的边缘特征和具有较低平滑度的平面特征通常被一致地提取，这对于匹配更为重要。因此，引入了权重函数来进一步平衡匹配过程。**为了减少计算量，重新使用先前定义的局部平滑度来确定权重函数。

通过求解非线性优化问题，我们可以得到基于上述对应关系的里程估计。然后，我们可以使用这个结果来计算新的对应关系和新的里程计。当前的姿态估计 $T_k^*$可以通过迭代姿态优化来解决，直到收敛。

**D 建图与失真补偿**

全局地图由边缘特征地图和平面特征地图组成，并基于关键帧进行更新。当平移变化大于预定义的平移阈值或旋转变化大于预定义的旋转阈值时，将选择作为关键帧。与逐帧更新相比，基于关键帧的地图更新可以减少计算量。如上所述，为了降低计算成本，基于恒定速度模型而不是迭代运动估计来执行失真补偿。然而，这不如 LOAM 迭代失真补偿的精度。因此，在第二阶段，根据上一步的优化结果$T_k^*$，通过以下方式重新计算失真：

重新计算的未失真边缘特征和平面特征将分别更新为全局边缘图和全局平面图。在每次更新之后，通过使用3D体素化网格方法[21]对映射进行下采样，以防止内存溢出。

## 4 实验

**A  实验设备**

为了验证该算法，我们在大尺度室外环境和中等尺度室内环境下对F-LOAM进行了评估。对于大规模实验，我们在KITTI数据集上评估了我们的方法，KITTI数据集是SLAM评估中最流行的数据集之一。然后将该算法集成到仓储物流中。首先在模拟仓库环境下进行了验证，然后在AGV平台上进行了测试。

**B 在公共数据集的评估**

首先在广泛用于户外定位评估的KITTI数据集上测试了我们的方法。数据集是从一辆装有Velodyne HDL-64激光雷达、相机和GPS的汽车上收集的。大多数最先进的SLAM方法都是在此数据集上进行评估的，例如ORB-SLAM、VINS Fusion、LIMO和LSD-SLAM。为了验证算法的鲁棒性，我们对KITTI数据集的所有序列（包括高速公路、市中心、县道、居民区等不同场景）进行了评估。

![img](https://ask.qcloudimg.com/http-save/yehe-5926470/9cc15239e09f578b81013a84170c462b.png?imageView2/2/w/1620)

​                 **图3:KITTI数据集序列00-10上不同定位方法的比较。**

**C 仓储物流实验**

在本实验中，我们的目标是建立一个自主的仓储机器人来取代人工主导的制造业。AGV设计用于执行日常任务，如运输。这就要求机器人平台在复杂的环境中主动定位。

1） 仿真环境：首先在一个仿真环境中验证我们的算法。仿真环境建立在Gazebo和Linux-ubuntu18.04上。如图4（a）所示，我们使用虚拟先锋机器人和虚拟Velodyne VLP-16作为地面车辆平台。模拟环境重建了一个复杂的仓库环境，包括各种对象，如移动的工人、货架、机器等。

![img](https://ask.qcloudimg.com/http-save/yehe-5926470/4dcbd1ee97fbb73608da9e8af817e996.png?imageView2/2/w/1620)

**图4：具有静态和动态对象的模拟仓库环境(a） 露台模拟环境(b） 模拟先锋机器人和Velodyne激光雷达进行评估(c） F-LOAM与地面真值的轨迹比较。**

2） 实验：为了进一步验证我们的方法的性能，我们在一个实际的用于[智能制造](https://cloud.tencent.com/solution/i_mfg?from=10680)的AGV上实现了F-LOAM。如图5（b-e）所示，仓库环境由三个主要区域组成：自动充电站、物料搬运区和制造站。一个完全自主的工厂需要机器人将材料运送到制造机器上进行装配和收集产品。所有这些操作都需要精确定位，以确保可靠性和安全性。用于测试的机器人平台如图5（a）所示，并配有Intel NUC微型计算机和Velodyne VLP-16传感器。定位和建图结果如图5所示。在这种情况下，机器人自动探索仓库，并使用所提出的方法同时构建地图。

![img](https://ask.qcloudimg.com/http-save/yehe-5926470/481ec781781c3271a8dc1382410d3cda.png?imageView2/2/w/1620)

**图5：仓库环境中的壤土(a） 用于实验的自动引导车(b-e）为AGV操作构建的先进工厂环境，包括操作机器、自动充电站和存储架。中心图像：仓库定位和建图的F-LOAM结果。**

**3） 性能评估**

本文提出的方法也在装有 VICON 系统的室内进行了测试，以评估其定位精度。机器人被遥控在测试区域内移动。结果如图6所示，其中F-LOAM轨迹和地面真实轨迹分别以绿色和红色绘制。可以看出，我们的方法可以精确地跟踪机器人的姿态。与 VICON 系统提供的地面真值相比，它的平均定位精度达到2厘米。

![img](https://ask.qcloudimg.com/http-save/yehe-5926470/1fe103e03a964f80421d1808d9a2c3d7.png?imageView2/2/w/1620)

**图6：所提出的方法与地面真值的比较。该方法能精确跟踪机器人的位姿，平均定位误差为2cm**

![img](https://ask.qcloudimg.com/http-save/yehe-5926470/7754d5842e18ce1d61e6b5784dedc595.png?imageView2/2/w/1620)

**定位精度和计算成本的对比**

## 5 总结

本文提出了一个计算效率高的LiDAR-SLAM框架，旨在为有限计算资源的机器人应用提供一个良好的解决方案。与传统方法相比，我们提出使用非迭代的两级失真补偿来减少计算量。另外，在连续扫描点云帧过程中，通常会提取局部平滑度较高的边缘特征和平滑度较低的平面特征，这对于扫描帧与地图的匹配更为重要。因此，在迭代姿态估计中也考虑了局部几何特征。为了验证该方法在实际应用中的鲁棒性，进行了深入的实验，包括仿真、室内AGV试验和室外自主驾驶试验。在室内测试中平均定位精度达到2cm，是KITTI数据集中最准确、最快的开源方法之一。